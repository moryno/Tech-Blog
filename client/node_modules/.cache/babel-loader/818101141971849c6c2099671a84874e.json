{"ast":null,"code":"import _defineProperty from\"/home/moryno/Development/Project/phase-2/tech-blog/client/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"/home/moryno/Development/Project/phase-2/tech-blog/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/moryno/Development/Project/phase-2/tech-blog/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/home/moryno/Development/Project/phase-2/tech-blog/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11;import{useContext,useState}from\"react\";import styled from\"styled-components\";import posts from\"../apis\";import{UserContext}from\"../context/Context\";import{getStorage,ref,uploadBytesResumable,getDownloadURL}from\"firebase/storage\";import app from\"../filebase\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Container=styled.section(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding-top: 3.125rem;\\n\"])));var Image=styled.img(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  margin-left: 9.375rem;\\n  width: 70vw;\\n  height: 15.625rem;\\n  border-radius: 0.625rem;\\n  object-fit: cover;\\n\"])));var ComposeForm=styled.form(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  position: relative;\\n\"])));var FormWrapper=styled.article(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  margin-left: 9.375rem;\\n  display: flex;\\n  align-items: center;\\n\"])));var Icon=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  margin-left: 1rem;\\n  width: 1.5625rem;\\n  height: 1.5625rem;\\n  border-radius: 50%;\\n  border: 1px solid;\\n  font-size: 1.25rem;\\n  color: rgb(121, 119, 119);\\n  cursor: pointer;\\n\"])));var Label=styled.label(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\"])));var FileInput=styled.input(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\"])));var TextInput=styled.input(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  font-size: 1.875rem;\\n  padding: 1.25rem;\\n  border: none;\\n  width: 70vw;\\n  &:focus {\\n    outline: none;\\n  }\\n\"])));var WriteGroup=styled.article(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  margin-left: 9.375rem;\\n  display: flex;\\n  align-items: center;\\n\"])));var Content=styled.textarea(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  font-size: 1.25rem;\\n  height: 100vh;\\n  padding: 1.25rem;\\n  border: none;\\n  width: 70vw;\\n  &:focus {\\n    outline: none;\\n  }\\n\"])));var Button=styled.button(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  top: 1.25rem;\\n  right: 3.125rem;\\n  border: none;\\n  color: white;\\n  background-color: teal;\\n  padding: 0.625rem;\\n  border-radius: 0.625rem;\\n  cursor: pointer;\\n  font-size: 1rem;\\n\"])));var Compose=function Compose(){var _useContext=useContext(UserContext),user=_useContext.user;var _useState=useState({title:\"\",desc:\"\",author:user.username,date:new Date()}),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setTitle=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),category=_useState4[0],setCategory=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),file=_useState6[0],setFile=_useState6[1];var handleChange=function handleChange(event){var _event$target=event.target,name=_event$target.name,value=_event$target.value;setTitle(_objectSpread(_objectSpread({},input),{},_defineProperty({},name,value)));};var handleCategory=function handleCategory(event){var value=event.target.value;setCategory(value.split(\",\"));};var handleSubmit=function handleSubmit(event){event.preventDefault();var fileName=new Date().getTime()+file.name;var storage=getStorage(app);var storageRef=ref(storage,fileName);var uploadTask=uploadBytesResumable(storageRef,file);// Register three observers:\n// 1. 'state_changed' observer, called any time the state changes\n// 2. Error observer, called on failure\n// 3. Completion observer, called on successful completion\nuploadTask.on(\"state_changed\",function(snapshot){// Observe state change events such as progress, pause, and resume\n// Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\nvar progress=snapshot.bytesTransferred/snapshot.totalBytes*100;console.log(\"Upload is \"+progress+\"% done\");switch(snapshot.state){case\"paused\":console.log(\"Upload is paused\");break;case\"running\":console.log(\"Upload is running\");break;default:break;}},function(error){// Handle unsuccessful uploads\n},function(){// Handle successful uploads on complete\n// For instance, get the download URL: https://firebasestorage.googleapis.com/...\ngetDownloadURL(uploadTask.snapshot.ref).then(function(downloadURL){var result=_objectSpread(_objectSpread({},input),{},{photo:downloadURL,category:category});try{var _posts$post=posts.post(\"/posts\",result),data=_posts$post.data;setTitle({title:\"\",desc:\"\"});}catch(error){console.log(error);}});});};return/*#__PURE__*/_jsxs(Container,{children:[file&&/*#__PURE__*/_jsx(Image,{src:URL.createObjectURL(file),alt:\"newImage\"}),/*#__PURE__*/_jsxs(ComposeForm,{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(FormWrapper,{children:[/*#__PURE__*/_jsx(Label,{htmlFor:\"fileInput\",children:/*#__PURE__*/_jsx(Icon,{children:/*#__PURE__*/_jsx(\"i\",{className:\"writeFormIcon fas fa-plus\"})})}),/*#__PURE__*/_jsx(FileInput,{onChange:function onChange(event){return setFile(event.target.files[0]);},type:\"file\",id:\"fileInput\",style:{display:\"none\"}}),/*#__PURE__*/_jsx(TextInput,{onChange:handleChange,type:\"text\",name:\"title\",value:input.title,placeholder:\"Title\",autoFocus:true}),/*#__PURE__*/_jsx(TextInput,{onChange:handleCategory,type:\"text\",name:\"category\",value:category,placeholder:\"Category\"})]}),/*#__PURE__*/_jsx(WriteGroup,{children:/*#__PURE__*/_jsx(Content,{onChange:handleChange,name:\"desc\",value:input.desc,placeholder:\"What is your story...?\"})}),/*#__PURE__*/_jsx(Button,{children:\"Publish\"})]})]});};export default Compose;","map":{"version":3,"names":["useContext","useState","styled","posts","UserContext","getStorage","ref","uploadBytesResumable","getDownloadURL","app","Container","section","Image","img","ComposeForm","form","FormWrapper","article","Icon","div","Label","label","FileInput","input","TextInput","WriteGroup","Content","textarea","Button","button","Compose","user","title","desc","author","username","date","Date","setTitle","category","setCategory","file","setFile","handleChange","event","target","name","value","handleCategory","split","handleSubmit","preventDefault","fileName","getTime","storage","storageRef","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","console","log","state","error","then","downloadURL","result","photo","post","data","URL","createObjectURL","files","display"],"sources":["/home/moryno/Development/Project/phase-2/tech-blog/client/src/pages/Compose.js"],"sourcesContent":["import { useContext, useState } from \"react\";\nimport styled from \"styled-components\";\nimport posts from \"../apis\";\nimport { UserContext } from \"../context/Context\";\nimport {\n  getStorage,\n  ref,\n  uploadBytesResumable,\n  getDownloadURL,\n} from \"firebase/storage\";\nimport app from \"../filebase\";\n\nconst Container = styled.section`\n  padding-top: 3.125rem;\n`;\n\nconst Image = styled.img`\n  margin-left: 9.375rem;\n  width: 70vw;\n  height: 15.625rem;\n  border-radius: 0.625rem;\n  object-fit: cover;\n`;\n\nconst ComposeForm = styled.form`\n  position: relative;\n`;\n\nconst FormWrapper = styled.article`\n  margin-left: 9.375rem;\n  display: flex;\n  align-items: center;\n`;\n\nconst Icon = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 1rem;\n  width: 1.5625rem;\n  height: 1.5625rem;\n  border-radius: 50%;\n  border: 1px solid;\n  font-size: 1.25rem;\n  color: rgb(121, 119, 119);\n  cursor: pointer;\n`;\n\nconst Label = styled.label``;\n\nconst FileInput = styled.input``;\n\nconst TextInput = styled.input`\n  font-size: 1.875rem;\n  padding: 1.25rem;\n  border: none;\n  width: 70vw;\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst WriteGroup = styled.article`\n  margin-left: 9.375rem;\n  display: flex;\n  align-items: center;\n`;\n\nconst Content = styled.textarea`\n  font-size: 1.25rem;\n  height: 100vh;\n  padding: 1.25rem;\n  border: none;\n  width: 70vw;\n  &:focus {\n    outline: none;\n  }\n`;\n\nconst Button = styled.button`\n  position: absolute;\n  top: 1.25rem;\n  right: 3.125rem;\n  border: none;\n  color: white;\n  background-color: teal;\n  padding: 0.625rem;\n  border-radius: 0.625rem;\n  cursor: pointer;\n  font-size: 1rem;\n`;\n\nconst Compose = () => {\n  const { user } = useContext(UserContext);\n  const [input, setTitle] = useState({\n    title: \"\",\n    desc: \"\",\n    author: user.username,\n    date: new Date(),\n  });\n  const [category, setCategory] = useState([]);\n  const [file, setFile] = useState(null);\n\n  const handleChange = (event) => {\n    const { name, value } = event.target;\n    setTitle({ ...input, [name]: value });\n  };\n\n  const handleCategory = (event) => {\n    const value = event.target.value;\n    setCategory(value.split(\",\"));\n  };\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    const fileName = new Date().getTime() + file.name;\n    const storage = getStorage(app);\n    const storageRef = ref(storage, fileName);\n\n    const uploadTask = uploadBytesResumable(storageRef, file);\n\n    // Register three observers:\n    // 1. 'state_changed' observer, called any time the state changes\n    // 2. Error observer, called on failure\n    // 3. Completion observer, called on successful completion\n    uploadTask.on(\n      \"state_changed\",\n      (snapshot) => {\n        // Observe state change events such as progress, pause, and resume\n        // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n        const progress =\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n        console.log(\"Upload is \" + progress + \"% done\");\n        switch (snapshot.state) {\n          case \"paused\":\n            console.log(\"Upload is paused\");\n            break;\n          case \"running\":\n            console.log(\"Upload is running\");\n            break;\n          default:\n            break;\n        }\n      },\n      (error) => {\n        // Handle unsuccessful uploads\n      },\n      () => {\n        // Handle successful uploads on complete\n        // For instance, get the download URL: https://firebasestorage.googleapis.com/...\n        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n          const result = { ...input, photo: downloadURL, category };\n          try {\n            const { data } = posts.post(`/posts`, result);\n            setTitle({\n              title: \"\",\n              desc: \"\",\n            });\n          } catch (error) {\n            console.log(error);\n          }\n        });\n      }\n    );\n  };\n\n  return (\n    <Container>\n      {file && <Image src={URL.createObjectURL(file)} alt=\"newImage\" />}\n      <ComposeForm onSubmit={handleSubmit}>\n        <FormWrapper>\n          <Label htmlFor=\"fileInput\">\n            <Icon>\n              <i className=\"writeFormIcon fas fa-plus\"></i>\n            </Icon>\n          </Label>\n          <FileInput\n            onChange={(event) => setFile(event.target.files[0])}\n            type={\"file\"}\n            id=\"fileInput\"\n            style={{ display: \"none\" }}\n          />\n          <TextInput\n            onChange={handleChange}\n            type={\"text\"}\n            name=\"title\"\n            value={input.title}\n            placeholder=\"Title\"\n            autoFocus={true}\n          />\n          <TextInput\n            onChange={handleCategory}\n            type={\"text\"}\n            name=\"category\"\n            value={category}\n            placeholder=\"Category\"\n          />\n        </FormWrapper>\n        <WriteGroup>\n          <Content\n            onChange={handleChange}\n            name=\"desc\"\n            value={input.desc}\n            placeholder=\"What is your story...?\"\n          />\n        </WriteGroup>\n        <Button>Publish</Button>\n      </ComposeForm>\n    </Container>\n  );\n};\n\nexport default Compose;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}